/* jQuery Drilldown Selector / version: 1.1.0 / author: Sean Metzgar */
(function(d){d.drilldownSelector=function(t,u){var h,r,v,z,l,m,s,b,p,q,w,k,x,y,n,c;this.version="1.1.0";h=1;r=0;v=!1;z={theme:"thin",loaderText:"Loading...",navBackText:"Back",navHomeText:"Home",onChange:function(){return!1}};l=d(t);w=q=p=b=s=m=null;k='{"sections": [';x=null;y="";n={};c={buildFramework:function(){m=d('<div class="drilldownSelectorContainer '+n.theme+'"></div>').insertAfter(l);p=d('<div class="drilldownSelectorNav"></div>').appendTo(m);q=d('<a href="#" class="back">'+n.navBackText+
"</a>").appendTo(p);w=d('<a href="#" class="home">'+n.navHomeText+"</a>").appendTo(p);s=d('<p class="drilldownSelectorLoader">'+n.loaderText+"</p>").appendTo(m);b=d('<div class="drilldownSelectorMenu"></div>').appendTo(m)},buildJSON:function(){l.find("option").each(function(){var a=d(this).text(),A=d(this).attr("value"),b=null,f=0,g=!1,b="",g=d(this).is(":selected")?!0:!1,e=!0;g&&(v?g=!1:v=!0);0<a.length&&(b=a.match(/^\-[\-]*\s/i),null!==b&&("object"===typeof b&&0<b.length&&"string"===typeof b[0])&&
(f=b[0].replace(/\s/i,"").length,b=a.replace(b[0],""),(g=c.addSection(f,b,A,g))?(k+=g,h=f):(k+=c.endJSON(),e=!1)));return e});k+=c.endJSON();x=JSON.parse(k)},buildHTML:function(a){var b="",d=null,f=null;if(a.hasOwnProperty("sections")&&0<a.sections.length){b+="<ul>";for(d in a.sections)a.sections.hasOwnProperty(d)&&(f=a.sections[d],b+="<li"+(!0===f.selected?' class="selected"':"")+'><a href="#" data-value="',b+=f.value+'">'+f.text+"</a>",f.sections&&0<f.sections.length&&(b+=c.buildHTML(f)),b+="</li>");
b+="</ul>"}return b},buildMenu:function(){y=c.buildHTML(x);b.append(y)},addSection:function(a,b,c,d){var g=0,e="";if(0!==r)if(a===h)e+="},";else if(a>h&&a===h+1)e+=', "sections": [';else if(a<h){for(g=1;g<=h-a;g+=1)e+="}]";e+="},"}else e=!1;else e=a===h?e+"":!1;!1!==e&&(e+='{"text": "'+b+'", "value": "'+c+'", "selected": '+(d?"true":"false"),r+=1);return e},endJSON:function(){for(var a=0,b="",a=1;a<=h;a+=1)b+="}]";return b+"}"},addClasses:function(){var a=b.find("li.selected");b.find("li").each(function(){0<
d(this).find("ul").length&&d(this).addClass("hasSubs")});0===a.length?b.children("ul").addClass("active"):1===a.length?a.parent("ul").addClass("active"):(a.removeClass("selected"),b.children("ul").addClass("active"));c.fixHeight();c.checkBackButton()},addCheckboxes:function(){var a=null;b.find("li").each(function(){isNaN(d(this).children("a").attr("data-value"))||d(this).children("a").append('<span class="checkbox">&nbsp;</span>')});a=b.find(".selected .checkbox").eq(0);1===a.length&&c.selectCheckbox(a)},
addListeners:function(){b.find("a").click(function(a){var b=null;a.preventDefault();b=d(this).parent("li");c.goForward(b)});b.find(".checkbox").click(function(a){a.preventDefault();a.stopPropagation();d(this).parents("li").eq(0).hasClass("selected")?c.deselectCheckbox():c.selectCheckbox(d(this))});q.click(function(a){a.preventDefault();c.goBack(!1)});w.click(function(a){a.preventDefault();c.goBack(!0)})},deselectCheckbox:function(){l.find("option").prop("selected",!1);b.find("li").removeClass("selected")},
selectCheckbox:function(a){var b=a.parent("a");a=a.parent("a").parent("li");b=b.attr("data-value");c.deselectCheckbox();a.addClass("selected");l.find("option[value="+b+"]").prop("selected",!0);n.onChange()},goBack:function(a){a="boolean"===typeof a?a:!1;c.deselectCheckbox();a?(b.find(".active").removeClass("active"),b.children("ul").addClass("active")):b.find(".active").removeClass("active").parents("ul:eq(0)").addClass("active");c.fixHeight();c.checkBackButton()},goForward:function(a){a.hasClass("hasSubs")&&
(c.deselectCheckbox(),b.find(".active").removeClass("active"),a.children("ul").addClass("active"),c.fixHeight(),c.checkBackButton())},checkBackButton:function(){b.children("ul").hasClass("active")?q.hide():q.show()},showLoader:function(){m.show();p.hide();b.hide();s.show()},showSelector:function(){m.show();s.hide();p.show();b.show()},fixHeight:function(){b.height(b.find(".active").height())}};this.init=function(){n=d.extend({},z,u);l.hide();c.buildFramework();c.showLoader();window.setTimeout?window.setTimeout(function(){c.buildJSON();
c.buildMenu();c.addClasses();c.addCheckboxes();c.addListeners();c.checkBackButton();c.showSelector();c.fixHeight()},1E3):(c.buildJSON(),c.buildMenu(),c.addClasses(),c.addCheckboxes(),c.addListeners(),c.checkBackButton(),c.showSelector(),c.fixHeight())};this.getValue=function(){var a=!1,a=l.val();switch(typeof a){case "string":break;case "object":a=0<a.length?a[0]:!1;break;default:a=!1}return a};this.init()};d.fn.drilldownSelector=function(t){return this.each(function(){if(void 0===d(this).data("drilldownSelector")){var u=
new d.drilldownSelector(this,t);d(this).data("drilldownSelector",u)}})}})(jQuery);